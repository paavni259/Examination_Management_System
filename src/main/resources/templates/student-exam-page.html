<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
  <meta charset="UTF-8">
  <title>Take Exam</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-color: #6366f1;
      --primary-hover: #4f46e5;
      --primary-light: #eef2ff;
      --bg-light: #f8fafc;
      --bg-panel: #ffffff;
      --text-dark: #0f172a;
      --text-secondary: #64748b;
      --border-color: #e2e8f0;
      --success-color: #10b981;
      --warning-color: #f59e0b;
      --danger-color: #ef4444;
    }
    
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg-light);
      color: var(--text-dark);
      line-height: 1.6;
    }
    
    /* Header */
    .exam-header {
      background: linear-gradient(135deg, var(--primary-color), var(--primary-hover));
      color: white;
      padding: 1.5rem 0;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .header-content {
      max-width: 1000px;
      margin: 0 auto;
      padding: 0 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .exam-info h1 {
      font-size: 1.875rem;
      font-weight: 700;
      margin-bottom: 0.25rem;
    }
    
    .exam-meta {
      font-size: 0.875rem;
      opacity: 0.9;
    }
    
    .timer-container {
      text-align: center;
    }

    .timer {
      background: rgba(255, 255, 255, 0.2);
      padding: 1rem 1.5rem;
      border-radius: 12px;
      font-size: 1.5rem;
      font-weight: 700;
      font-family: 'Courier New', monospace;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }
    
    .timer.warning {
      background: rgba(245, 158, 11, 0.2);
      border-color: rgba(245, 158, 11, 0.3);
    }
    
    .timer.danger {
      background: rgba(239, 68, 68, 0.2);
      border-color: rgba(239, 68, 68, 0.3);
      animation: pulse 1s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    /* Progress Bar */
    .progress-container {
      background: var(--bg-panel);
      padding: 1rem 0;
      border-bottom: 1px solid var(--border-color);
    }
    
    .progress-content {
      max-width: 1000px;
      margin: 0 auto;
      padding: 0 2rem;
    }
    
    .progress-bar {
      width: 100%;
      height: 8px;
      background: var(--border-color);
      border-radius: 4px;
      overflow: hidden;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary-color), var(--primary-hover));
      transition: width 0.3s ease;
      border-radius: 4px;
    }
    
    .progress-text {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
      font-size: 0.875rem;
      color: var(--text-secondary);
    }
    
    /* Main Content */
    .main-content {
      max-width: 1000px;
      margin: 0 auto;
      padding: 2rem;
    }
    
    .question-container {
      background: var(--bg-panel);
      border-radius: 12px;
      padding: 2rem;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      margin-bottom: 2rem;
    }
    
    .question {
      display: none;
      animation: fadeIn 0.3s ease;
    }
    
    .question.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .question-number {
      display: inline-block;
      background: var(--primary-light);
      color: var(--primary-color);
      padding: 0.5rem 1rem;
      border-radius: 999px;
      font-size: 0.875rem;
      font-weight: 600;
      margin-bottom: 1rem;
    }
    
    .question-text {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text-dark);
      margin-bottom: 1.5rem;
      line-height: 1.5;
    }
    
    .options {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    
    .option {
      display: flex;
      align-items: center;
      padding: 1rem 1.25rem;
      border: 2px solid var(--border-color);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      background: var(--bg-light);
    }
    
    .option:hover {
      border-color: var(--primary-color);
      background: var(--primary-light);
      transform: translateY(-1px);
    }
    
    .option.selected {
      border-color: var(--primary-color);
      background: var(--primary-light);
    }
    
    .option input[type="radio"] {
      margin-right: 1rem;
      width: 18px;
      height: 18px;
      accent-color: var(--primary-color);
    }
    
    .option-text {
      font-size: 1rem;
      color: var(--text-dark);
      font-weight: 500;
    }
    
    /* Navigation */
    .navigation {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.5rem 0;
      border-top: 1px solid var(--border-color);
    }
    
    .nav-buttons {
      display: flex;
      gap: 1rem;
    }

    .btn {
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-weight: 500;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      transition: all 0.2s;
      border: none;
      cursor: pointer;
      font-size: 0.875rem;
    }
    
    .btn-primary {
      background: var(--primary-color);
      color: white;
    }
    
    .btn-primary:hover:not(:disabled) {
      background: var(--primary-hover);
      transform: translateY(-1px);
    }
    
    .btn-secondary {
      background: var(--bg-light);
      color: var(--text-secondary);
      border: 1px solid var(--border-color);
    }
    
    .btn-secondary:hover:not(:disabled) {
      background: var(--border-color);
      color: var(--text-dark);
    }
    
    .btn-success {
      background: var(--success-color);
      color: white;
    }
    
    .btn-success:hover:not(:disabled) {
      background: #059669;
      transform: translateY(-1px);
    }
    
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .question-counter {
      font-size: 0.875rem;
      color: var(--text-secondary);
      font-weight: 500;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .header-content {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
      }
      
      .main-content {
        padding: 1rem;
      }
      
      .question-container {
        padding: 1.5rem;
      }
      
      .navigation {
        flex-direction: column;
        gap: 1rem;
      }
      
      .nav-buttons {
        width: 100%;
        justify-content: space-between;
      }
      
      .btn {
        flex: 1;
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="exam-header">
    <div class="header-content">
      <div class="exam-info">
        <h1 th:text="${exam.title}">Exam Title</h1>
        <div class="exam-meta">
          <span th:text="${exam.course}">Course Name</span> â€¢ 
          <span th:text="${exam.duration} + ' minutes'">Duration</span>
        </div>
  </div> 
      <div class="timer-container">
    <div class="timer" id="timer" th:attr="data-minutes=${exam.duration}">--:--</div>
        <div style="font-size: 0.75rem; margin-top: 0.5rem; opacity: 0.8;">Time Remaining</div>
      </div>
  </div>
  </header>
  
  <!-- Progress Bar -->
  <div class="progress-container">
    <div class="progress-content">
      <div class="progress-text">
        <span>Progress</span>
        <span id="progressText">1 of 1</span>
      </div>
  <div class="progress-bar">
    <div class="progress-fill" id="progressFill"></div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <main class="main-content">
  <form th:action="@{/students/exams/{id}/submit(id=${exam.id})}"
        th:object="${wrapper}" method="post" id="examForm">

    <div th:each="q, iStat : ${questions}"
           class="question"
         th:classappend="${iStat.index == 0} ? ' active'">

        <div class="question-container">
          <div class="question-number" th:text="'Question ' + ${iStat.index + 1}">Question 1</div>
          <h2 class="question-text" th:text="${q.questionText}">Question text here</h2>

      <input type="hidden" th:field="*{answers[__${iStat.index}__].questionId}" th:value="${q.id}"/>
      <input type="hidden" th:field="*{answers[__${iStat.index}__].examId}" th:value="${exam.id}"/>
      <input type="hidden" th:field="*{answers[__${iStat.index}__].studentId}"/>

          <div class="options">
            <label th:each="opt : ${#strings.arraySplit(q.options, ',')}" class="option">
          <input type="radio"
                 th:field="*{answers[__${iStat.index}__].answerText}"
                     th:value="${#strings.trim(opt)}"
                     th:onclick="this.closest('.option').classList.add('selected'); document.querySelectorAll('.question.active .option').forEach(el => { if (el !== this.closest('.option')) el.classList.remove('selected'); });"
                     required/>
              <span class="option-text" th:text="${#strings.trim(opt)}">Option text</span>
        </label>
          </div>
      </div>
    </div>

      <div class="navigation">
        <div class="question-counter" id="questionCounter">Question 1 of 1</div>
        <div class="nav-buttons">
          <button type="button" class="btn btn-secondary" id="prevBtn">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
            </svg>
            Previous
          </button>
          <button type="button" class="btn btn-primary" id="nextBtn">
            Next
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
            </svg>
          </button>
          <button type="submit" class="btn btn-success" id="submitBtn" disabled>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            Submit Exam
          </button>
        </div>
    </div>
  </form>
  </main>

<script>
(function(){
      const questions = Array.from(document.querySelectorAll('.question'));
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const submitBtn = document.getElementById('submitBtn');
  const progressFill = document.getElementById('progressFill');
      const progressText = document.getElementById('progressText');
      const questionCounter = document.getElementById('questionCounter');

      let currentQuestion = 0;
      const totalQuestions = questions.length;

  function updateView() {
        // Show/hide questions
        questions.forEach((el, i) => el.classList.toggle('active', i === currentQuestion));
        
        // Update navigation buttons
        prevBtn.disabled = currentQuestion === 0;
        nextBtn.disabled = currentQuestion === totalQuestions - 1;
        submitBtn.disabled = currentQuestion !== totalQuestions - 1;
        
        // Update progress
        const progress = ((currentQuestion + 1) / totalQuestions) * 100;
        progressFill.style.width = progress + '%';
        progressText.textContent = `${currentQuestion + 1} of ${totalQuestions}`;
        questionCounter.textContent = `Question ${currentQuestion + 1} of ${totalQuestions}`;
      }

      prevBtn.addEventListener('click', () => {
        if (currentQuestion > 0) {
          currentQuestion--;
          updateView();
        }
      });

      nextBtn.addEventListener('click', () => {
        if (currentQuestion < totalQuestions - 1) {
          currentQuestion++;
  updateView();
        }
      });

      // Timer functionality
  const timerEl = document.getElementById('timer');
  const minutesAttr = timerEl.getAttribute('data-minutes');
  let remaining = Math.max(1, parseInt(minutesAttr || '1', 10)) * 60;

      function formatTime(seconds) {
        const minutes = Math.floor(seconds / 60);
        const secs = seconds % 60;
        return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
      }

      function updateTimer() {
        timerEl.textContent = formatTime(remaining);
        
        if (remaining <= 300) { // 5 minutes
          timerEl.classList.add('warning');
        }
        if (remaining <= 60) { // 1 minute
          timerEl.classList.remove('warning');
          timerEl.classList.add('danger');
        }
      }

      updateTimer();
      
      const timerInterval = setInterval(() => {
    remaining--;
        updateTimer();
        
    if (remaining <= 0) {
          clearInterval(timerInterval);
          alert('Time is up! Your exam will be submitted automatically.');
      document.getElementById('examForm').submit();
    }
  }, 1000);

      // Initialize view
      updateView();
})();
</script>
</body>
</html>