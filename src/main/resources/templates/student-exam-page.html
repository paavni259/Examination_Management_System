<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
  <meta charset="UTF-8">
  <title>Take Exam</title>
  <style>
    body {
      font-family: 'Inter', 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #e0f2fe, #f1f5f9);
      margin: 0;
      padding: 40px 0;
      color: #1e293b;
    }

    .container {
      max-width: 800px;
      margin: auto;
      background: #fff;
      padding: 40px 50px;
      border-radius: 16px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.08);
      transition: box-shadow 0.3s;
    }
    .container:hover { box-shadow: 0 8px 22px rgba(0,0,0,0.1); }

    .top-links {
      margin-bottom: 20px;
    }
    .top-links a {
      color: #2563eb;
      text-decoration: none;
      font-weight: 500;
      font-size: 14px;
    }
    .top-links a:hover { text-decoration: underline; }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    h2 {
      font-size: 24px;
      font-weight: 600;
      margin: 0;
      color: #0f172a;
    }

    .meta {
      font-size: 14px;
      color: #475569;
      margin-bottom: 22px;
    }

    .timer {
      font-weight: 600;
      font-size: 15px;
      padding: 8px 14px;
      border: 2px solid #cbd5e1;
      border-radius: 8px;
      background: #f1f5f9;
      color: #1e293b;
      transition: color 0.3s, border-color 0.3s;
    }
    .timer.low {
      color: #dc2626;
      border-color: #dc2626;
    }

    /* Progress bar */
    .progress-bar {
      width: 100%;
      height: 8px;
      background: #e2e8f0;
      border-radius: 4px;
      overflow: hidden;
      margin: 20px 0 28px;
    }
    .progress-fill {
      height: 100%;
      width: 0%;
      background: #2563eb;
      transition: width 0.3s ease;
    }

    .q {
      display: none;
      margin-bottom: 26px;
      animation: fadeIn 0.4s ease;
    }
    .q.active { display: block; }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    h4 {
      font-size: 17px;
      font-weight: 600;
      margin: 12px 0 18px;
      color: #1e293b;
    }

    .opt {
      display: block;
      margin: 12px 0;
      font-size: 14px;
      color: #334155;
      cursor: pointer;
      border: 1px solid #e2e8f0;
      border-radius: 10px;
      padding: 14px 16px;
      background: #f8fafc;
      transition: background 0.2s, border 0.2s, transform 0.1s;
    }
    .opt:hover {
      background: #f1f5f9;
      border-color: #93c5fd;
      transform: scale(1.01);
    }
    input[type="radio"] {
      margin-right: 10px;
      accent-color: #2563eb;
    }
    input[type="radio"]:checked + span {
      font-weight: 600;
      color: #1e40af;
    }

    .nav {
      display: flex;
      gap: 12px;
      margin-top: 20px;
    }

    .btn {
      padding: 14px 20px;
      border: none;
      border-radius: 10px;
      font-size: 15px;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s ease;
    }
    .btn-primary { background: #2563eb; color: #fff; }
    .btn-primary:hover { background: #1e40af; }
    .btn-secondary { background: #6b7280; color: #fff; }
    .btn-secondary:hover { background: #4b5563; }

    .btn[disabled] {
      opacity: 0.5;
      cursor: not-allowed;
    }

    @media (max-width: 600px) {
      .container { padding: 30px 20px; }
      .nav { flex-direction: column; }
      .btn { width: 100%; }
    }
  </style>
</head>
<body>
<div class="container">
  <div class="top-links">
   <!-- <a th:href="@{/students/exams}">&larr; Back to Exams</a> -->
  </div> 

  <div class="header">
    <h2 th:text="${exam.title}">Exam Title</h2>
    <div class="timer" id="timer" th:attr="data-minutes=${exam.duration}">--:--</div>
  </div>

  <p class="meta">
    <span th:text="'Course: ' + ${exam.course}">Course</span> &nbsp;â€¢&nbsp;
    <span th:text="'Duration: ' + ${exam.duration} + ' mins'">Duration</span>
  </p>

  <div class="progress-bar">
    <div class="progress-fill" id="progressFill"></div>
  </div>

  <form th:action="@{/students/exams/{id}/submit(id=${exam.id})}"
        th:object="${wrapper}" method="post" id="examForm">

    <div th:each="q, iStat : ${questions}"
         class="q"
         th:classappend="${iStat.index == 0} ? ' active'">

      <h4 th:text="'Q' + ${iStat.index + 1} + '. ' + ${q.questionText}">Question</h4>

      <input type="hidden" th:field="*{answers[__${iStat.index}__].questionId}" th:value="${q.id}"/>
      <input type="hidden" th:field="*{answers[__${iStat.index}__].examId}" th:value="${exam.id}"/>
      <input type="hidden" th:field="*{answers[__${iStat.index}__].studentId}"/>

      <div th:each="opt : ${#strings.arraySplit(q.options, ',')}">
        <label class="opt">
          <input type="radio"
                 th:field="*{answers[__${iStat.index}__].answerText}"
                 th:value="${#strings.trim(opt)}" required/>
          <span th:text="${#strings.trim(opt)}"></span>
        </label>
      </div>
    </div>

    <div class="nav">
      <button type="button" class="btn btn-secondary" id="prevBtn">Previous</button>
      <button type="button" class="btn btn-primary" id="nextBtn">Next</button>
      <button type="submit" class="btn btn-primary" id="submitBtn" disabled>Submit Exam</button>
    </div>
  </form>
</div>

<script>
(function(){
  const questions = Array.from(document.querySelectorAll('.q'));
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const submitBtn = document.getElementById('submitBtn');
  const progressFill = document.getElementById('progressFill');

  let idx = 0;
  const total = questions.length;

  function updateView() {
    questions.forEach((el, i) => el.classList.toggle('active', i === idx));
    prevBtn.disabled = idx === 0;
    nextBtn.disabled = idx === total - 1;
    submitBtn.disabled = idx !== total - 1;
    const pct = ((idx+1) / total) * 100;
    progressFill.style.width = pct + '%';
  }

  prevBtn.addEventListener('click', () => { if (idx > 0) { idx--; updateView(); } });
  nextBtn.addEventListener('click', () => { if (idx < total - 1) { idx++; updateView(); } });

  updateView();

  // countdown timer
  const timerEl = document.getElementById('timer');
  const minutesAttr = timerEl.getAttribute('data-minutes');
  let remaining = Math.max(1, parseInt(minutesAttr || '1', 10)) * 60;

  function fmt(sec){
    const m = Math.floor(sec / 60);
    const s = sec % 60;
    return `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
  }

  timerEl.textContent = fmt(remaining);
  const tick = setInterval(() => {
    remaining--;
    if (remaining <= 60) timerEl.classList.add('low');
    timerEl.textContent = fmt(Math.max(0, remaining));
    if (remaining <= 0) {
      clearInterval(tick);
      document.getElementById('examForm').submit();
    }
  }, 1000);
})();
</script>
</body>
</html>
